# Compressed-Embed

A resource-embedding tool for C++23.

## Overview

Given a file like:

```json
{
  "input_files" :
  {
    "CompressedEmbed" : "D:/OpenKneeboard-Removal-Tool/cmake-build-local-fui/vcpkg_installed/x64-windows-static/share/compressed-embed/copyright",
    "FUI" : "D:/OpenKneeboard-Removal-Tool/cmake-build-local-fui/vcpkg_installed/x64-windows-static/share/fredemmott-gui/copyright",
    "Self" : "D:/OpenKneeboard-Removal-Tool/LICENSE",
    "WIL" : "D:/OpenKneeboard-Removal-Tool/cmake-build-local-fui/vcpkg_installed/x64-windows-static/share/wil/copyright",
    "Yoga" : "D:/OpenKneeboard-Removal-Tool/cmake-build-local-fui/vcpkg_installed/x64-windows-static/share/yoga/copyright"
  },
  "output_class_name" : "Licenses",
  "output_cpp_file" : "D:/OpenKneeboard-Removal-Tool/cmake-build-local-fui/src/licenses.cpp",
  "output_hpp_file" : "D:/OpenKneeboard-Removal-Tool/cmake-build-local-fui/src/include/licenses.hpp"
}
```

`compressed-embed.exe /path/to/foo.json` will produce a header file like this, and a matching implementation file:

```c++
// @generated by compressed-embed
#pragma once
#include <array>
#include <span>
#include <string_view>

class Licenses {
 private:
  static constinit std::array<std::byte, 968> mCompressed;
  std::array<std::byte, 6724> mDecompressed;
 public:
  Licenses();

  std::span<const std::byte, 1086> Yoga() const noexcept;
  std::string_view YogaAsStringView() const noexcept;
  
  // ... Repeat for other input files.
};
```

You can then include the `.cpp` and `.hpp` files in your project; you will also need to link against the `compress-embed` library.

You can also specify:
- `output_namespace`: put the generated class inside a namespace
- `backend`: one of the following
  - `Win32_MSZIP` *(default)*: The Windows compression API, using DEFLATE compression
  - `Win32_LZMS`: The Windows compression API, using Microsoft's undocumented LZMS compression

## CMake integration

This library can be used via `FetchContent`, `ExternalProject_add`, `add_subdirectory()`, or `find_package()`. You can use `find_program()` to find the `compressed-embed` program,
and it defines a `compressed-embed::runtime` target for the library.

An `add_compressed_embed_library()` function is also available from `CompressedEmbed.cmake`:

```cmake
find_package(compressed-embed CONFIG REQUIRED)
include(CompressedEmbed)
add_compressed_embed_library(
  licenses
  OUTPUT_CPP "${CMAKE_CURRENT_BINARY_DIR}/licenses.cpp"
  OUTPUT_HPP "${CMAKE_CURRENT_BINARY_DIR}/include/licenses.hpp"
  NAMESPACE "MyProject::Foo"
  CLASSNAME Licenses
  INPUTS
  Foo "${CMAKE_CURRENT_SOURCE_DIR}/foo.txt"
  Bar "${CMAKE_CURRENT_SOURCE_DIR}/bar.txt"
)
target_include_directories(licenses PUBLIC "${CMAKE_CURRENT_BINARY_DIR}/include")
target_link_libraries(main PRIVATE licenses)      
```

- The first parameter of each pair to `INPUTS` must be a valid C function name
- The produced library automatically depends on the `compressed-embed::runtime` library

## Installing this tool

vcpkg is recommended, using the `compressed-embed` port in [my vcpkg registry](https://github.com/fredemmott/vcpkg-registry); see [Microsoft's documentation](https://learn.microsoft.com/en-us/vcpkg/consume/git-registries) for how to use git-based registries.

## Requirements

- C++23
- Windows

Windows is currently required as compression and decompression have only been implemented using the Win32 APIs; it would
be straightforward to add support for other compression libraries such as zlib or zstd. Other than the current
compression/decompression functions, the tool is not fundamentally Windows-specific.

## License

This project is [MIT-licensed](LICENSE).